<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
  integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
  crossorigin="anonymous"
/>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>
<style>
  .chart {
    width: 100%;
    max-height: 20rem;
    /* background-color: black; */
  }
  table {
    width: 100%;
  }
</style>
<html>
  <div class="container-fluid">
    <div class="row mt-3">
      <div class="col">
        <h1 class="ms-5">Admin Dashboard</h1>
      </div>
      <div class="col">
        <a class="link text-danger float-end mx-1"
          ><i class="fa fa-right-from-bracket"></i> Logout</a
        >
        <a
          class="link text-danger float-end mx-1"
          target="_blank"
          href="https://github.com/berrytechnics/repair_leads/issues/new"
          ><i class="fa fa-bug"></i> Report Bug</a
        >
        <a
          class="link text-danger float-end mx-1"
          href="#"
          ><i class="fa fa-user-astronaut"></i> Manage Users</a
        >
      </div>
    </div>
    <div class="row">
      <div class="col chart chart-leads-byStore">
        <canvas id="leads-byStore" class="chart"></canvas>
      </div>
    </div>
    <div class="row mt-3">
      <hr />
      <div class="col">
        <table id="leadsTable" class="stripe hover">
          <thead>
            <tr>
              <th>Location</th>
              <th>Date</th>
              <th>Name</th>
              <th>Email</th>
              <th>Device</th>
              <th>Issue</th>
              <th>Quote</th>
            </tr>
          </thead>
          <tbody>
            <% models.forEach(model=>{ %>
            <tr>
              <td><%- model.location %></td>
              <td><%- new Date(model.date).toLocaleDateString() %></td>
              <td><%- model.name %></td>
              <td><%- model.email %></td>
              <td><%- model.model %></td>
              <td><%- model.issue %></td>
              <td><%- model.price %></td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</html>
<script
  src="https://code.jquery.com/jquery-3.6.4.min.js"
  integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
  crossorigin="anonymous"
></script>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
  integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
  crossorigin="anonymous"
></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"
  integrity="sha512-BkpSL20WETFylMrcirBahHfSnY++H2O1W+UnEEO4yNIl+jI2+zowyoGJpbtk6bx97fBXf++WJHSSK2MV4ghPcg=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script>
  var models = JSON.parse(`<%- JSON.stringify(models) %>`);

  const byStoreColors = [];
  const byStore_X = models
    .map((model) => model.location)
    .filter((model, i, self) => self.indexOf(model) === i);
  const byStore_Y = [];
  byStore_X.forEach((store) => {
    const color = "#" + Math.floor(Math.random() * 16777215).toString(16);
    byStoreColors.push(color);
    const leads = models.filter((model) => model.location == store);
    byStore_Y.push(leads.length);
  });

  const leadsByStoreChart = new Chart("leads-byStore", {
    type: "bar",
    data: {
      labels: byStore_X,
      datasets: [
        {
          backgroundColor: byStoreColors,
          data: byStore_Y,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      legend: { display: false },
      title: {
        display: true,
        text: `Total Leads (current month)`,
      },
    },
  });

  $(document).ready(function () {
    $("#leadsTable").DataTable({
      dom: "Bfrtip",
      pageLength: 1000,
      buttons: ["csv"],
    });
  });
</script>
